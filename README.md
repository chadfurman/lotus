## Introduction to Lotus

Lotus is simply a script runner with menus in a CLGUI (that's command-line graphical user interface...) All functionality beyond the initial load-up is provided by plugins. 

Plugins are simply bash scripts that exist in the $LOTUS_DIR/lib folder and follow a few conventions (see below for more on plugin development)



## Core plugins

The following core plugins come with Lotus:

* target
    * The most important command -- creates files in the $LOTUS_DIR/data/target/ directory (i.e. host, website, domain, etc)
* pingsweep
    * (re-)generates a list of active hosts (using data from target) in $LOTUS_DIR/data/pingsweep/active_hosts
* save_project
    * Create a tarball of the data directory and save it to $LOTUS_DIR/saved_data
* load_project
    * List out saved projects and facilitate extracting them to $LOTUS_DIR/data
* clear_project
    * Delete $LOTUS_DIR/data
* Other
    * There are several other plugins in the $LOTUS_DIR/lib folder -- check them out :)

## Menus
Plugins can either include a menu or simply be nothing but a menu, serving as a way to organize other commands.  

Some of the existing menus come with Lotus are:
* Recon (menu)
    * Tools for the active/passive discovery stage of a pentest
* Attack (menu)
    * Tools for exploitation.  Websites, binaries, social engineering, etc.
* Misc. (menu)
    * Utilities like color code references, hex/binary encoders, etc


## Creating Plugins

#### Basic Plugins
A great example of a basic plugin is the colors.sh plugin

1) All plugins start with the following line: `#!/usr/bin/env bash`
2) If a plugin is named "some_plugin.sh" then that plugin has a "some_plugin()" function which serves as its main method
3) To ensure that plugins can either be run from the CLI or from a `source`, include the following
```
if [[ "$0" == "$BASH_SOURCE" ]]; then
	target "$@"
fi
```
4) Define all variables at the start of the file.  Give them default values, but don't override any values from globals.  For example:
```
#!/usr/bin/env bash
DIR=${DIR:-$( cd "$( dirname "${BASH_SOURCE[0]}" )/../" && pwd )}
DATA=${DATA:-"$DIR/data"}
HEADER_HEIGHT=${HEADER_HEIGHT:-0}
BASE_INDENT=${BASE_INDENT:-0}
PROMPT_LINE=${PROMPT_LINE:-20}
TARGET_LINE=${TARGET_LINE:-12}
```
5) Plugins that take in options must have a parse_flags() function which gets called by init and sets environment variables from the CLI args (or any other flag-based action):
```
parse_flags() {
	while [ ! $# -eq 0 ]
	do
		case "$1" in
			--help | -h)
				helpmenu
				exit
				;;
			--data | -d)
				shift
				DATA=$1
				;;
			--saved-data | -s)
				shift
				SAVED_DATA=$1
				;;
			--name | -n)
				shift
				NAME=$1
				;;
		esac
		shift
	done
}
```
6) Plugins must have a helpmenu function that details their purpose and any arguments they take.

#### Plugins with menus
A great example of a plugin with a menu is the target.sh plugin.

If the plugin has a menu, there are a additional conventions:

2) The "some_plugin()" method calls "init()" which ensures the output directories exist and all dependencies are met
3) The "some_plugin()" method prints a banner _under_ the main "Lotus" banner by targeting line $((HEADER_HEIGHT+1))
4) To ensure the menu loops after each answer, the "some_plugin()" method ends the following way:
```
	tput cup "$PROMPT_LINE" 0
	read -p 'Enter selection: ' selection
	if handle_target "$selection"; then
		target
		return $?
	fi
	return 1
```
5) There exists a "handle_some_plugin()" function which switches on the menu item and performs an action
    * Ideas for actions performed by scripts include (but are not limited to): 
        * generating data in $LOTUS_DIR/data/some_plugin/<file>
        * parsing data generated by other plugins
        * calling other plugins
        * showing additional menus
6) The "handle_some_plugin()" menu returns 0 to loop and 1 to go up a menu (or exit if called directly)
7) Plugins with menus must be able to take the menu selection as an argument when called directly


        
